<!doctype html><html lang=en dir=ltr><head><title>Chrome | THM Writeup :: CyberJagadeesh - Learn Cyber Security</title>
<meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Introduction Detailed walkthroughs for Chrome CTF challenges on TryHackMe .
Description A password manager is only as strong as the password that encrypts it. You find that a malicious actor extracted something over the network, but what? Help us find out!
1.What is the first password that we find? 2.What is the URL found in the first index? Fully defang the URL 3.What is the password found in the first index?"><meta name=keywords content="cyber security,penetration testing,ethical hacking,vulnerability assessment,network security,application security,web application security,security testing,red teaming,bug bounty,CTFs,cybersecurity challenges,hacking tutorials,security tools,exploit development,reverse engineering,penetration tester,security researcher,security analyst,information security,digital forensics,incident response,threat intelligence,security awareness,social engineering,phishing,malware analysis,cryptography,cloud security,IoT security,mobile security,how to become a penetration tester,penetration testing tools,CTF challenges for beginners,web application penetration testing,network penetration testing,exploit development tutorial,reverse engineering techniques,bug bounty hunting tips,security research projects,cyber security certifications"><meta name=robots content="noodp"><link rel=manifest href=/manifest.json><meta property="og:url" content="https://cyberjagadeesh.github.io/posts/chrome/writeup/"><meta property="og:site_name" content="CyberJagadeesh"><meta property="og:title" content="Chrome | THM Writeup"><meta property="og:description" content="Introduction Detailed walkthroughs for Chrome CTF challenges on TryHackMe .
Description A password manager is only as strong as the password that encrypts it. You find that a malicious actor extracted something over the network, but what? Help us find out!
1.What is the first password that we find? 2.What is the URL found in the first index? Fully defang the URL 3.What is the password found in the first index?"><meta property="og:locale" content="en"><meta property="og:type" content="article"><meta property="article:section" content="posts"><meta property="article:published_time" content="2024-09-10T09:58:25+05:30"><meta property="article:modified_time" content="2024-09-10T09:58:25+05:30"><meta property="article:tag" content="Wireshark"><meta property="article:tag" content="ILSpy"><meta property="article:tag" content="AppData[Windows]"><meta property="article:tag" content="DPAPImk2john"><meta property="article:tag" content="John"><meta property="article:tag" content="Pypykatz"><meta property="og:see_also" content="https://cyberjagadeesh.github.io/posts/u.a.highschool/writeup/"><meta property="og:see_also" content="https://cyberjagadeesh.github.io/posts/airplane/writeup/"><meta property="og:see_also" content="https://cyberjagadeesh.github.io/posts/thenewyorkflankees/writeup/"><meta property="og:see_also" content="https://cyberjagadeesh.github.io/posts/cyberlens/writeup/"><meta name=twitter:card content="summary"><meta name=twitter:title content="Chrome | THM Writeup"><meta name=twitter:description content="Introduction Detailed walkthroughs for Chrome CTF challenges on TryHackMe .
Description A password manager is only as strong as the password that encrypts it. You find that a malicious actor extracted something over the network, but what? Help us find out!
1.What is the first password that we find? 2.What is the URL found in the first index? Fully defang the URL 3.What is the password found in the first index?"><link rel=canonical href=https://cyberjagadeesh.github.io/posts/chrome/writeup/><link rel="shortcut icon" href=/favicon.ico><link rel=stylesheet href=/css/index.min.1f9b3e6594d41770030cc9cea67e9220cd9066bb33910ebfb19ea46cf6b4b50c.css><script async src="https://www.googletagmanager.com/gtag/js?id=G-376DY6PW0W"></script><script>var dnt,doNotTrack=!1;if(!1&&(dnt=navigator.doNotTrack||window.doNotTrack||navigator.msDoNotTrack,doNotTrack=dnt=="1"||dnt=="yes"),!doNotTrack){window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-376DY6PW0W")}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"Article","author":{"@type":"Person","name":"CyberJagadeesh"},"dateModified":"2024-09-10T09:58:25+05:30","datePublished":"2024-09-10T09:58:25+05:30","description":"Introduction Detailed walkthroughs for Chrome CTF challenges on TryHackMe .\nDescription A password manager is only as strong as the password that encrypts it. You find that a malicious actor extracted something over the network, but what? Help us find out!\n1.What is the first password that we find? 2.What is the URL found in the first index? Fully defang the URL 3.What is the password found in the first index?","image":"/posts/chrome/Chrome.png","name":"Chrome | THM Writeup","url":"https://cyberjagadeesh.github.io/posts/chrome/writeup/"}</script></head><body class="flex flex-col min-h-screen w-full bg-slate-50 dark:bg-gray-800"><header class="flex flex-none justify-center z-10"><div class="flex flex-row gap justify-between w-full max-w-4xl lg:max-w-5xl h-12 mt-3"><div class="flex-none ml-2 md:ml-0"><a href=/><img class="h-12 w-12 rounded-full object-cover bg-gray-100" src=/logo.png alt=logo></a></div><div class=flex-1></div><div class=flex-none><nav class="h-full static"><button id=navbar-menu-toggle type=button class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg md:hidden" aria-controls=navbar-menu aria-expanded=false>
<span class=sr-only>Open main menu</span>
<i class="w-8 h-8"><svg class="icon icon-tabler icon-tabler-menu-2" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 6h16"/><path d="M4 12h16"/><path d="M4 18h16"/></svg></i></button><div class="absolute md:static top-16 left-0 right-0 z-50 hidden w-full md:block md:w-auto" id=navbar-menu><ul class="flex flex-col mx-2 md:mx-0 md:flex-row md:border-0 rounded-sm md:rounded-full px-3 text-base font-medium text-slate-800 dark:text-slate-200 shadow-lg bg-white dark:bg-gray-600 shadow-slate-800/5 dark:shadow-slate-200/5 ring-1 ring-slate-900/5 dark:ring-slate-100/5"><li id=about><a class="block px-3 py-3 hover:text-emerald-600" href=/about/ title=About>About</a></li><li id=post><a class="block px-3 py-3 hover:text-emerald-600 text-emerald-600" href=/posts/ title=Post>Post</a></li></ul></div></nav></div><div class="flex-none mx-1"></div><div class="flex-none md:hidden"><a href=/search/ class="inline-flex items-center p-2 text-sm text-slate-800 dark:text-slate-200 rounded-lg" aria-controls=navbar-menu aria-expanded=false><span class=sr-only>Search</span>
<i class="w-8 h-8"><svg class="icon icon-tabler icon-tabler-search" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M10 10m-7 0a7 7 0 1014 0A7 7 0 103 10"/><path d="M21 21l-6-6"/></svg></i></a></div><div class="darkmode-toggle flex flex-none mr-2 md:mr-0"><label for=darkmode-toggle class="flex items-center px-3 cursor-pointer rounded-full bg-gray-100 dark:bg-gray-600" title="Toggle dark mode"><input name=darkmode-toggle id=darkmode-toggle type=checkbox class="sr-only peer" aria-label="Toggle dark mode"><div class="group flex flex-row gap-1 justify-center h-8 px-1 rounded-full bg-white dark:bg-gray-700"><i class="h-6 w-6 flex-none rounded-full bg-yellow-400 place-self-center peer-checked:group-[]:invisible"><svg class="icon icon-tabler icon-tabler-brightness-down" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-3 0a3 3 0 106 0 3 3 0 10-6 0"/><path d="M12 5v.01"/><path d="M17 7v.01"/><path d="M19 12v.01"/><path d="M17 17v.01"/><path d="M12 19v.01"/><path d="M7 17v.01"/><path d="M5 12v.01"/><path d="M7 7v.01"/></svg>
</i><i class="h-6 w-6 flex-none rounded-full place-self-center invisible peer-checked:group-[]:visible"><svg class="icon icon-tabler icon-tabler-moon-stars" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 3c.132.0.263.0.393.0a7.5 7.5.0 007.92 12.446A9 9 0 1112 2.992z"/><path d="M17 4a2 2 0 002 2 2 2 0 00-2 2 2 2 0 00-2-2 2 2 0 002-2"/><path d="M19 11h2m-1-1v2"/></svg></i></div></label></div></div></header><main class="flex flex-auto justify-center"><div class="w-full max-w-4xl lg:max-w-5xl"><div class="flex flex-col mt-6 mx-2 md:mx-0 rounded-lg overflow-hidden shadow-md bg-white dark:bg-gray-700"><div><a href=/posts/chrome/writeup/><figure><img class="w-full object-cover h-36 md:h-48 xl:h-60" src=/posts/chrome/Chrome.png alt="Chrome | THM Writeup" title="Chrome | THM Writeup" loading=lazy></figure></a></div><div class="flex flex-col gap-y-3 p-6"><h1 class="text-4xl font-semibold text-slate-800 dark:text-slate-100"><a href=/posts/chrome/writeup/>Chrome | THM Writeup</a></h1><ul class="flex flex-row flex-wrap text-slate-500 dark:text-slate-300"><li><a href=/categories/ctf/ class="text-sm mr-2 px-2 py-1 rounded border border-emerald-800 bg-emerald-800 text-slate-50">CTF</a></li><li><a href=/categories/forensic/ class="text-sm mr-2 px-2 py-1 rounded border border-emerald-800 bg-emerald-800 text-slate-50">Forensic</a></li><li><a href=/tags/wireshark/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Wireshark</span></a></li><li><a href=/tags/ilspy/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>ILSpy</span></a></li><li><a href=/tags/appdatawindows/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>AppData[Windows]</span></a></li><li><a href=/tags/dpapimk2john/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>DPAPImk2john</span></a></li><li><a href=/tags/john/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>John</span></a></li><li><a href=/tags/pypykatz/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Pypykatz</span></a></li><li><a href=/tags/mimikatz/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Mimikatz</span></a></li><li><a href=/series/tryhackme/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Tryhackme</span></a></li><li><a href=/platforms/windows/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Windows</span></a></li><li><a href=/levels/hard/ class="flex flex-row text-sm mr-2 py-1"><i class="h-5 w-5 flex-none"><svg class="icon icon-tabler icon-tabler-hash" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 9h14"/><path d="M5 15h14"/><path d="M11 4 7 20"/><path d="M17 4l-4 16"/></svg>
</i><span class=ml-0>Hard</span></a></li></ul><div class="flex flex-col gap-y-1 md:flex-row md:gap-y-0 md:gap-x-4 text-slate-500 dark:text-slate-300"><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-calendar" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 7a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2V7z"/><path d="M16 3v4"/><path d="M8 3v4"/><path d="M4 11h16"/><path d="M11 15h1"/><path d="M12 15v3"/></svg>
</i><time datetime=2024-09-10T09:58:25+05:30>2024-09-10</time></div><div class="flex flex-row text-base gap-x-1"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-hourglass-high" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6.5 7h11"/><path d="M6 20v-2a6 6 0 1112 0v2a1 1 0 01-1 1H7a1 1 0 01-1-1z"/><path d="M6 4v2a6 6 0 1012 0V4a1 1 0 00-1-1H7A1 1 0 006 4z"/></svg>
</i><span>8 minutes to read</span></div></div><section class="prose prose-slate dark:prose-invert w-full max-w-4xl lg:max-w-5xl mt-6"><h2>Table of Contents</h2><aside><nav id=TableOfContents><ul><li><a href=#introduction>Introduction</a><ul><li><a href=#description>Description</a></li></ul></li><li><a href=#enumaration>Enumaration</a><ul><li><a href=#wireshark>Wireshark</a></li><li><a href=#ilspy>ILSpy</a></li><li><a href=#decrypting-aes>Decrypting AES</a></li><li><a href=#appdata-windows>AppData [Windows]</a></li></ul></li><li><a href=#solving-using-linux>Solving using Linux</a><ul><li><a href=#db-browser-for-sqlite>DB Browser for SQLite</a></li><li><a href=#dpapimk2john>DPAPImk2john</a></li><li><a href=#pypykatz>pypykatz</a></li></ul></li><li><a href=#solving-using-windows>Solving using Windows</a><ul><li><a href=#dpapimk2johnpy>DPAPImk2john.py</a></li><li><a href=#mimikatz>mimikatz</a></li></ul></li></ul></nav></aside></section><article class="mt-6 w-full max-w-4xl lg:max-w-5xl prose prose-slate dark:prose-invert prose-quoteless post-content"><h2 id=introduction>Introduction</h2><p>Detailed walkthroughs for <a href=https://tryhackme.com/r/room/chrome target=_blank rel=noopener>Chrome</a>
CTF challenges on <a href=https://tryhackme.com target=_blank rel=noopener>TryHackMe</a>
.</p><h3 id=description>Description</h3><p>A password manager is only as strong as the password that encrypts it. You find that a malicious actor extracted something over the network, but what? Help us find out!</p><pre tabindex=0><code>1.What is the first password that we find?
2.What is the URL found in the first index? Fully defang the URL
3.What is the password found in the first index?
4.What is the URL found in the second index? Fully defang the URL
5.What is the password found in the second index?
</code></pre><p>From the above questions, we assume that will find the paswords and urls using the task file.</p><h2 id=enumaration>Enumaration</h2><p>We downloaded the task file from <a href=https://tryhackme.com/r/room/chrome target=_blank rel=noopener>Chrome|THM</a>
page, and unzipped it. We got a <code>.pcapng</code> file.</p><pre tabindex=0><code>-rw-r--r--  1 root root  73M Mar 18 21:36 chromefiles-1697949492677.zip
-rwxr-xr-x  1 root root  73M Oct 22  2023 traffic.pcapng
</code></pre><h3 id=wireshark>Wireshark</h3><figure><img src=/posts/chrome/1.png title=Wireshark:traffic.pcapng style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Wireshark:traffic.pcapng</strong></figcaption></figure><p><figure><img src=/posts/chrome/2.png title="Protocol Hieraracy" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Protocol Hieraracy</strong></figcaption></figure>By checking <code>Statics --> Protocol Hieraracy</code>, we have <code>SMB</code> data in the captured file.</p><p><figure><img src=/posts/chrome/3.png title="Export- SMB objects list" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Export- SMB objects list</strong></figcaption></figure>We got the interesting files to be extracted.</p><pre tabindex=0><code>-rw-r--r--  1 root root  72M Aug 18 22:33 encrypted_files
-rw-r--r--  1 root root  160 Aug 18 22:36 srvsvc
-rw-r--r--  1 root root 5.5K Aug 18 22:36 transfer.exe
</code></pre><h3 id=ilspy>ILSpy</h3><p>Lets try to get more information from these files, start with <code>transfer.exe</code>. Here we need to reverse <code>.exe</code> file, using <a href=https://github.com/icsharpcode/ilspy-vscode target=_blank rel=noopener>git/icsharpcode/ilspy-vscode</a>
reference &ndash;><a href=https://book.hacktricks.xyz/reversing/reversing-tools-basic-methods#ilspy-and-dnspy target=_blank rel=noopener>HackTricks:ReversingTools:ILSpy</a>
&ndash;> <a href="https://marketplace.visualstudio.com/items?itemName=icsharpcode.ilspy-vscode" target=_blank rel=noopener>ILSpy Extension</a>
.</p><p><figure><img src=/posts/chrome/8.png title="ILSpy Extension VSCode" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>ILSpy Extension VSCode</strong></figcaption></figure>Installing/updating latest version of VSCode and installing <code>ILSpy Extension VSCode</code> extension.</p><p><figure><img src=/posts/chrome/9.png title="Decompiling transfer.exe" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Decompiling transfer.exe</strong></figcaption></figure>Right click on exe file and select <code>Decompile Selected assembly</code> to decompile the file.</p><p><figure><img src=/posts/chrome/10.png title="Decompiled output" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Decompiled output</strong></figcaption></figure>From the above image we knows the function of tranfer.exe file:</p><ol><li>Reads the data from <code>C:\Users\hadri\Downloads\files.zip</code> and encrypt as <code>C:\Users\hadri\Downloads\encrypted_files</code>.</li><li>Encryption algorithm used is <code>AES</code>.</li><li>Key: <code>PjoM95MpBdz85Kk7ewcXSLWCoAr7mRj1</code></li><li>IV (Initialization Vector): <code>lR3soZqkaWZ9ojTX</code></li></ol><h3 id=decrypting-aes>Decrypting AES</h3><p>Lets decrypt the encrypted file.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Cipher</span> <span class=kn>import</span> <span class=n>AES</span>                                                                                                                                
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>Crypto.Util.Padding</span> <span class=kn>import</span> <span class=n>unpad</span>                                                                                                                        
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>                                                                                                                                                   
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Replace these with your actual decryption key and initialization vector (IV)</span>
</span></span><span class=line><span class=cl><span class=n>key</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;PjoM95MpBdz85Kk7ewcXSLWCoAr7mRj1&#34;</span>  <span class=c1># 16-byte key (128-bit)</span>
</span></span><span class=line><span class=cl><span class=n>iv</span> <span class=o>=</span> <span class=sa>b</span><span class=s2>&#34;lR3soZqkaWZ9ojTX&#34;</span>  <span class=c1># 16-byte IV</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>decrypt_file</span><span class=p>(</span><span class=n>encrypted_file_path</span><span class=p>,</span> <span class=n>decrypted_file_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Decrypts a file using AES-128 in CBC mode with PKCS#7 padding.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>    Args:
</span></span></span><span class=line><span class=cl><span class=s2>        encrypted_file_path (str): Path to the encrypted file.
</span></span></span><span class=line><span class=cl><span class=s2>        decrypted_file_path (str): Path to save the decrypted file.
</span></span></span><span class=line><span class=cl><span class=s2>    &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>encrypted_file_path</span><span class=p>,</span> <span class=s1>&#39;rb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>encrypted_file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>ciphertext</span> <span class=o>=</span> <span class=n>encrypted_file</span><span class=o>.</span><span class=n>read</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=n>cipher</span> <span class=o>=</span> <span class=n>AES</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=n>key</span><span class=p>,</span> <span class=n>AES</span><span class=o>.</span><span class=n>MODE_CBC</span><span class=p>,</span> <span class=n>iv</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>plaintext</span> <span class=o>=</span> <span class=n>unpad</span><span class=p>(</span><span class=n>cipher</span><span class=o>.</span><span class=n>decrypt</span><span class=p>(</span><span class=n>ciphertext</span><span class=p>),</span> <span class=n>AES</span><span class=o>.</span><span class=n>block_size</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>decrypted_file_path</span><span class=p>,</span> <span class=s1>&#39;wb&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>decrypted_file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>decrypted_file</span><span class=o>.</span><span class=n>write</span><span class=p>(</span><span class=n>plaintext</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Example usage (replace paths accordingly)</span>
</span></span><span class=line><span class=cl><span class=n>encrypted_file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl><span class=n>decrypted_file_path</span> <span class=o>=</span> <span class=n>sys</span><span class=o>.</span><span class=n>argv</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=n>decrypt_file</span><span class=p>(</span><span class=n>encrypted_file_path</span><span class=p>,</span> <span class=n>decrypted_file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nb>print</span><span class=p>(</span><span class=s2>&#34;File decrypted successfully!&#34;</span><span class=p>)</span>
</span></span></code></pre></div><p>I fed the transfer.exe contents, containing an encryption mechanism, to an AI tool, and it produced the necessary decryption script. Save the above python script as <code>decryption.py</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>pip3 install pycryptodome <span class=c1># to use Crypto in Python env</span>
</span></span><span class=line><span class=cl>python3 decryption.py encrypted_files decrypted_file.zip
</span></span><span class=line><span class=cl>unzip decrypted_file.zip -d decrypted_files
</span></span></code></pre></div><p>Now we got the decrypted contents of the file encrypted_files. Let&rsquo;s go through the files.</p><h3 id=appdata-windows>AppData [Windows]</h3><p>We have the <code>AppData</code> file of Windows OS, which is a hidden system folder that stores application data and settings specific to the user profile. It is used by Windows and installed applications to store user-specific information such as configuration files, temporary files, saved sessions, caches, and other necessary data.</p><p><figure><img src=/posts/chrome/14.png title="Google Search: Chrome Passwords AppData " style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Google Search: Chrome Passwords AppData</strong></figcaption></figure>We got a interesting file result in simple google search. Lets analyze that.</p><h2 id=solving-using-linux>Solving using Linux</h2><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ file decrypted_files/AppData/Local/Google/Chrome/User<span class=se>\ </span>Data/Default/Login<span class=se>\ </span>Data                                                                          
</span></span><span class=line><span class=cl>decrypted_files/AppData/Local/Google/Chrome/User Data/Default/Login Data: SQLite 3.x database, last written using SQLite version 3039004, page size 2048, file counter 1, database pages 23, cookie 0xd, schema 4, UTF-8, version-valid-for <span class=m>1</span>
</span></span></code></pre></div><p>Found an interesting database file.</p><pre tabindex=0><code>AppData/Roaming/Microsoft/Protect/S-1-5-21-3854677062-280096443-3674533662-1001/8c6b6187-8eaa-48bd-be16-98212a441580
AppData/Local/Google/Chrome/User\ Data/Default/Login\ Data
AppData/Local/Google/Chrome/User\ Data/Local\ State
</code></pre><p>After further enumaration found some other important files.</p><h3 id=db-browser-for-sqlite>DB Browser for SQLite</h3><figure><img src=/posts/chrome/11.png title="DB Browser for SQLite" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>DB Browser for SQLite</strong></figcaption></figure><p>Using pre installed <a href=https://sqlitebrowser.org/ target=_blank rel=noopener>DB Browser for SQLite</a>
in Kali Linux, We found an <code>Database Structure</code> and interesting table <code>logins</code> using the file <code>Login Data</code>.</p><figure><img src=/posts/chrome/12.png title="Table: Logins" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Table: Logins</strong></figcaption></figure><p>We got the important data like <code>usernames, passwords and website urls</code> from the database. But here the password field contains the binary data which is unreadable.<br>Here we got flag2 and flag4.</p><h3 id=dpapimk2john>DPAPImk2john</h3><p>We can use <code>DPAPImk2john</code> to crack the users password to proceed further.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=n>pip</span> <span class=n>install</span> <span class=n>pycryptodome</span>
</span></span><span class=line><span class=cl><span class=c1># installing dependency for DPAPImk2john</span>
</span></span></code></pre></div><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ DPAPImk2john -h
</span></span><span class=line><span class=cl>usage: DPAPImk2john <span class=o>[</span>-h<span class=o>]</span> <span class=o>[</span>-S SID<span class=o>]</span> <span class=o>[</span>-mk MASTERKEY<span class=o>]</span> <span class=o>[</span>-d<span class=o>]</span> <span class=o>[</span>-c <span class=o>{</span>domain,domain1607+,domain1607-,local<span class=o>}]</span> <span class=o>[</span>-P PREFERRED<span class=o>]</span> <span class=o>[</span>--password PASSWORD<span class=o>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>options:
</span></span><span class=line><span class=cl>  -h, --help            show this <span class=nb>help</span> message and <span class=nb>exit</span>
</span></span><span class=line><span class=cl>  -S SID, --sid SID     SID of account owning the masterkey file.
</span></span><span class=line><span class=cl>  -mk MASTERKEY, --masterkey MASTERKEY
</span></span><span class=line><span class=cl>                        masterkey file <span class=o>(</span>usually in %APPDATA%<span class=se>\P</span>rotect<span class=se>\&lt;</span>SID&gt;<span class=o>)</span>.
</span></span><span class=line><span class=cl>  -d, --debug
</span></span><span class=line><span class=cl>  -c <span class=o>{</span>domain,domain1607+,domain1607-,local<span class=o>}</span>, --context <span class=o>{</span>domain,domain1607+,domain1607-,local<span class=o>}</span>
</span></span><span class=line><span class=cl>                        context of user account. <span class=m>1607</span> refers to Windows <span class=m>10</span> <span class=m>1607</span> update.
</span></span><span class=line><span class=cl>  -P PREFERRED, --preferred PREFERRED
</span></span><span class=line><span class=cl>                        <span class=s1>&#39;Preferred&#39;</span> file containing GUID of masterkey file in use <span class=o>(</span>usually in %APPDATA%<span class=se>\P</span>rotect<span class=se>\&lt;</span>SID&gt;<span class=o>)</span>. Cannot be used with any other
</span></span><span class=line><span class=cl>                        command.
</span></span><span class=line><span class=cl>  --password PASSWORD   password to decrypt masterkey file.
</span></span></code></pre></div><p>DPAPImk2john Tool Usage.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ DPAPImk2john -S <span class=s2>&#34;S-1-5-21-3854677062-280096443-3674533662-1001&#34;</span> -mk AppData/Roaming/Microsoft/Protect/S-1-5-21-3854677062-280096443-3674533662-1001/8c6b6187-8eaa-48bd-be16-98212a441580 -c <span class=s2>&#34;local&#34;</span>
</span></span><span class=line><span class=cl><span class=nv>$DPAPImk$2</span>*1*S-1-5-21-3854677062-280096443-3674533662-1001*aes256*sha512*8000*46bc22dbffb7cfe4cfc5895acf364a94*288*a332e98ce791b7416157137e7193596d4594dc599acc321f6ed9e94a818879461639b958099ab61361c7fd4d6668ca2d8995488ffba78758b945dcbfc60498c84b14c8021fbee8d90cf4165637222c8a6cd1eb3c5a85acf85177b1ec86240c7e077eb5e427e27832f3481664baf54c06cb3bb47bcfc253620958f02f69bc98ece8e51b6ef3c498047efb4a2b57bf804b
</span></span><span class=line><span class=cl>$
</span></span><span class=line><span class=cl>$ DPAPImk2john -S <span class=s2>&#34;S-1-5-21-3854677062-280096443-3674533662-1001&#34;</span> -mk AppData/Roaming/Microsoft/Protect/S-1-5-21-3854677062-280096443-3674533662-1001/8c6b6187-8eaa-48bd-be16-98212a441580 -c <span class=s2>&#34;local&#34;</span> &gt; ../DPAPIdecryption.txt
</span></span></code></pre></div><p>Generating the hash to decrypt using <code>DPAPImk2john</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ john ../DPAPIdecryption.txt --wordlist<span class=o>=</span>/usr/share/wordlists/rockyou.txt
</span></span><span class=line><span class=cl>Using default input encoding: UTF-8
</span></span><span class=line><span class=cl>Loaded <span class=m>1</span> password <span class=nb>hash</span> <span class=o>(</span>DPAPImk, DPAPI masterkey file v1 and v2 <span class=o>[</span>SHA1/MD4 PBKDF2-<span class=o>(</span>SHA1/SHA512<span class=o>)</span>-DPAPI-variant 3DES/AES256 256/256 AVX2 8x<span class=o>])</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=o>[</span>password-redacted<span class=o>]</span>          <span class=o>(</span>?<span class=o>)</span>     
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>Session completed. 
</span></span></code></pre></div><p>Cracking the passsword of the user using <code>John the Ripper</code> tool.<br>Here we got the flag 1.</p><h3 id=pypykatz>pypykatz</h3><p>Here we found a tool called <a href=https://github.com/skelsec/pypykatz target=_blank rel=noopener>pypykatz</a>
, used to crack the chrome passwords.</p><p><figure><img src=/posts/chrome/13.png title="Process of decrypting DPAPI secrets" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Process of decrypting DPAPI secrets</strong></figcaption></figure>This <a href=https://github.com/skelsec/pypykatz/wiki/dpapi#decryption-process target=_blank rel=noopener>diagram</a>
shows how to get the secrets(passwords). AS YOU CAN SEE to get secrets you will need multiple things, just waving one file an expecting things to magically decrypt themselves will not work.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ pypykatz dpapi chrome -h
</span></span><span class=line><span class=cl>usage: pypykatz dpapi chrome <span class=o>[</span>-h<span class=o>]</span> <span class=o>[</span>--logindata LOGINDATA<span class=o>]</span> <span class=o>[</span>--cookies COOKIES<span class=o>]</span> mkf localstate
</span></span><span class=line><span class=cl>$
</span></span><span class=line><span class=cl>$ pypykatz dpapi masterkey -h
</span></span><span class=line><span class=cl>usage: pypykatz dpapi masterkey <span class=o>[</span>-h<span class=o>]</span> <span class=o>[</span>-o OUT_FILE<span class=o>]</span> masterkeyfile prekey
</span></span><span class=line><span class=cl>$
</span></span><span class=line><span class=cl>$ pypykatz dpapi prekey password test_password
</span></span><span class=line><span class=cl>usage: pypykatz password <span class=o>[</span>-h<span class=o>]</span> <span class=o>[</span>-o OUT_FILE<span class=o>]</span> sid password
</span></span></code></pre></div><p>Use these commands for known the tool usage.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>$ pypykatz dpapi prekey password S-1-5-21-3854677062-280096443-3674533662-1001 <span class=o>[</span>password-redacted<span class=o>]</span>
</span></span><span class=line><span class=cl>31a620ca577e6ad02ae701673bee51d32aa5538b
</span></span><span class=line><span class=cl>16f809ed93fff267679b64095ec2ed54f20da076
</span></span><span class=line><span class=cl>266c0db66dda55bcf2a3bf948c9176f9d0073f30
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ pypykatz dpapi masterkey -o mk1.txt 8c6b6187-8eaa-48bd-be16-98212a441580 31a620ca577e6ad02ae701673bee51d32aa5538b
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>$ pypykatz dpapi chrome --logindata Login<span class=se>\ </span>Data mk1.txt Local<span class=se>\ </span>State       
</span></span><span class=line><span class=cl>file: Login Data user: Administrator pass: b<span class=s1>&#39;[redacted-Password]&#39;</span> url: 
</span></span><span class=line><span class=cl>file: Login Data user: chrome pass: b<span class=s1>&#39;[redacted-Password]&#39;</span> url:
</span></span></code></pre></div><p>We got the passwords here (Flag 3 and Flag 5).</p><h2 id=solving-using-windows>Solving using Windows</h2><h3 id=dpapimk2johnpy>DPAPImk2john.py</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>PS</span> <span class=nf>Z:\</span><span class=p>&gt;</span> <span class=nf>pip</span> <span class=nf>install</span> <span class=nf>--user</span> <span class=nf>pycryptodome</span>
</span></span><span class=line><span class=cl><span class=nf>PS</span> <span class=nf>Z:\</span><span class=p>&gt;</span> <span class=nf>notepad</span> <span class=nf>DPAPImk2john.py</span>
</span></span></code></pre></div><p>Installing dependency for <a href=https://github.com/openwall/john/blob/bleeding-jumbo/run/DPAPImk2john.py target=_blank rel=noopener><code>DPAPImk2john.py</code></a>
and copy pasting the <code>.py</code> file using notepad.<br>Tool: <a href=https://www.openwall.com/john/ target=_blank rel=noopener>JohnTheRipper</a>
, latest version for <a href=https://www.openwall.com/john/k/john-1.9.0-jumbo-1-win64.zip target=_blank rel=noopener>Windowsx64</a>
.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>PS</span> <span class=nf>Z:\</span><span class=p>&gt;</span> <span class=nf>python</span> <span class=nf>.\DPAPImk2john.py</span> <span class=nf>-S</span> <span class=nf>&#34;S-1-5-21-3854677062-280096443-3674533662-1001&#34;</span> <span class=nf>-mk</span> <span class=nf>&#34;Z:\AppData\Roaming\Microsoft\Protect\S-1-5-21-3854677062-280096443-3674533662-1001\8c6b6187-8eaa-48bd-be16-98212a441580&#34;</span> <span class=nf>-c</span> <span class=nf>&#34;local&#34;</span> <span class=p>&gt;</span> <span class=nf>hash.txt</span>
</span></span><span class=line><span class=cl><span class=nf>PS</span> <span class=nf>Z:\</span><span class=p>&gt;</span> <span class=nf>john-1.9.0-jumbo-1-win64\run\john.exe</span> <span class=nf>hash.txt</span> <span class=nf>--wordlist=rockyou.txt</span>
</span></span><span class=line><span class=cl><span class=nf>Error:</span> <span class=nf>UTF-16</span> <span class=nf>BOM</span> <span class=nf>seen</span> <span class=nf>in</span> <span class=nf>input</span> <span class=nf>file.</span>
</span></span></code></pre></div><p>Running <code>john.exe</code> to crack the password, we got the error.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>PS</span> <span class=nf>Z:\</span><span class=p>&gt;</span>  <span class=nf>$InputFile</span> <span class=nf>=</span> <span class=nf>&#34;hash.txt&#34;</span> <span class=nf>;</span> <span class=nf>$OutputFile</span> <span class=nf>=</span> <span class=nf>&#34;hash_utf8.txt&#34;;</span> <span class=nf>$Text</span> <span class=nf>=</span> <span class=nf>Get-Content</span> <span class=nf>-Path</span> <span class=nf>$InputFile</span> <span class=nf>-Raw;</span> <span class=nf>$Text</span> <span class=nf>|</span> <span class=nf>Out-File</span> <span class=nf>-FilePath</span> <span class=nf>$OutputFile</span> <span class=nf>-Encoding</span> <span class=nf>utf8</span>
</span></span></code></pre></div><p>Converting the data <code>from UTF-16 to UTF-8</code> format to solve the error and saving it in <code>hash_utf8.txt</code>.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>PS</span> <span class=nf>Z:\</span><span class=p>&gt;</span> <span class=nf>john-1.9.0-jumbo-1-win64\run\john.exe</span> <span class=nf>.\hash_utf8.txt</span> <span class=nf>--wordlist=rockyou.txt</span>
</span></span><span class=line><span class=cl><span class=nf>Using</span> <span class=nf>default</span> <span class=nf>input</span> <span class=nf>encoding:</span> <span class=nf>UTF-8</span>
</span></span><span class=line><span class=cl><span class=nf>Loaded</span> <span class=mf>1</span> <span class=nf>password</span> <span class=nf>hash</span> <span class=s>(DPAPImk, DPAPI masterkey file v1 and v2 [SHA1/MD4 PBKDF2-(SHA1/SHA512)-DPAPI-variant 3DES/AES256 256/256 AVX2 8x])</span>
</span></span><span class=line><span class=cl><span class=nf>Cost</span> <span class=mf>1</span> <span class=s>(iteration count)</span> <span class=nf>is</span> <span class=mf>8000</span> <span class=nf>for</span> <span class=nf>all</span> <span class=nf>loaded</span> <span class=nf>hashes</span>
</span></span><span class=line><span class=cl><span class=nf>Will</span> <span class=nf>run</span> <span class=mf>2</span> <span class=nf>OpenMP</span> <span class=nf>threads</span>
</span></span><span class=line><span class=cl><span class=nf>Press</span> <span class=nf>&#39;q&#39;</span> <span class=nf>or</span> <span class=nf>Ctrl-C</span> <span class=nf>to</span> <span class=nf>abort,</span> <span class=nf>almost</span> <span class=nf>any</span> <span class=nf>other</span> <span class=nf>key</span> <span class=nf>for</span> <span class=nf>status</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nf>password-redacted</span><span class=p>]</span>          <span class=s>(?)</span>
</span></span><span class=line><span class=cl><span class=nf>1g</span> <span class=nf>0:00:00:00</span> <span class=nf>DONE</span> <span class=s>(2024-09-09 06:40)</span> <span class=nf>4.807g</span><span class=nv>/s</span> <span class=nf>307.6p</span><span class=nv>/s</span> <span class=nf>307.6c</span><span class=nv>/s</span> <span class=nf>307.6C</span><span class=nv>/s</span> <span class=nf>123456..charlie</span>
</span></span><span class=line><span class=cl><span class=nf>Use</span> <span class=nf>the</span> <span class=nf>&#34;--show&#34;</span> <span class=nf>option</span> <span class=nf>to</span> <span class=nf>display</span> <span class=nf>all</span> <span class=nf>of</span> <span class=nf>the</span> <span class=nf>cracked</span> <span class=nf>passwords</span> <span class=nf>reliably</span>
</span></span><span class=line><span class=cl><span class=nf>Session</span> <span class=nf>completed</span>
</span></span></code></pre></div><p>Successfully cracked the user password.</p><h3 id=mimikatz>mimikatz</h3><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>PS</span> <span class=nf>Z:\</span><span class=p>&gt;</span> <span class=nf>Z:\mimikatz\x64\mimikatz.exe</span> <span class=nf>#</span> <span class=nf>starting</span> <span class=nf>mimi</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>  <span class=nf>.#####.</span>   <span class=nf>mimikatz</span> <span class=nf>2.2.0</span> <span class=s>(x64)</span> <span class=nf>#19041</span> <span class=nf>Sep</span> <span class=mf>19</span> <span class=mf>2022</span> <span class=nf>17:44:08</span>
</span></span><span class=line><span class=cl> <span class=nf>.##</span> <span class=nf>^</span> <span class=nf>##.</span>  <span class=nf>&#34;A</span> <span class=nf>La</span> <span class=nf>Vie,</span> <span class=nf>A</span> <span class=nf>L&#39;Amour&#34;</span> <span class=nf>-</span> <span class=s>(oe.eo)</span>
</span></span><span class=line><span class=cl> <span class=nf>##</span> <span class=err>/</span> <span class=nf>\</span> <span class=nf>##</span>  <span class=nv>/***</span> <span class=nf>Benjamin</span> <span class=nf>DELPY</span> <span class=nf>`gentilkiwi`</span> <span class=s>( benjamin@gentilkiwi.com )</span>
</span></span><span class=line><span class=cl> <span class=nf>##</span> <span class=nf>\</span> <span class=err>/</span> <span class=nf>##</span>       <span class=p>&gt;</span> <span class=nf>https:</span><span class=err>/</span><span class=nv>/blog.gentilkiwi.com/mimikatz</span>
</span></span><span class=line><span class=cl> <span class=nf>&#39;##</span> <span class=nf>v</span> <span class=nf>##&#39;</span>       <span class=nf>Vincent</span> <span class=nf>LE</span> <span class=nf>TOUX</span>             <span class=s>( vincent.letoux@gmail.com )</span>
</span></span><span class=line><span class=cl>  <span class=nf>&#39;#####&#39;</span>        <span class=p>&gt;</span> <span class=nf>https:</span><span class=err>/</span><span class=nv>/pingcastle.com</span> <span class=err>/</span> <span class=nf>https:</span><span class=err>/</span><span class=nv>/mysmartlogon.com</span> <span class=nf>***</span><span class=err>/</span>
</span></span></code></pre></div><p>Lets use <a href=https://github.com/ParrotSec/mimikatz target=_blank rel=noopener>Mimikatz</a>
.</p><h4 id=masterkey>MASTERKEY</h4><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>mimikatz</span> <span class=nf>#</span> <span class=nf>dpapi::masterkey</span> <span class=nv>/in:&#34;Z:\AppData\Roaming\Microsoft\Protect\S-1-5-21-3854677062-280096443-3674533662-1001\8c6b6187-8eaa-48bd-be16-98212a441580&#34;</span> <span class=nv>/sid:S-1-5-21-3854677062-280096443-3674533662-1001</span> <span class=nv>/password:</span><span class=p>[</span><span class=nf>password</span> <span class=nf>redacted</span><span class=p>]</span> <span class=nv>/protected</span>
</span></span><span class=line><span class=cl><span class=nf>**MASTERKEYS**</span>
</span></span><span class=line><span class=cl>  <span class=nf>dwVersion</span>          <span class=nf>:</span> <span class=mf>00000002</span> <span class=nf>-</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl>  <span class=nf>szGuid</span>             <span class=nf>:</span> <span class=p>{</span><span class=nf>8c6b6187-8eaa-48bd-be16-98212a441580</span><span class=p>}</span>
</span></span><span class=line><span class=cl>  <span class=nf>dwFlags</span>            <span class=nf>:</span> <span class=mf>00000005</span> <span class=nf>-</span> <span class=mf>5</span>
</span></span><span class=line><span class=cl>  <span class=nf>dwMasterKeyLen</span>     <span class=nf>:</span> <span class=nf>000000b0</span> <span class=nf>-</span> <span class=mf>176</span>
</span></span><span class=line><span class=cl>  <span class=nf>dwBackupKeyLen</span>     <span class=nf>:</span> <span class=mf>00000090</span> <span class=nf>-</span> <span class=mf>144</span>
</span></span><span class=line><span class=cl>  <span class=nf>dwCredHistLen</span>      <span class=nf>:</span> <span class=mf>00000014</span> <span class=nf>-</span> <span class=mf>20</span>
</span></span><span class=line><span class=cl>  <span class=nf>dwDomainKeyLen</span>     <span class=nf>:</span> <span class=mf>00000000</span> <span class=nf>-</span> <span class=mf>0</span>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nf>masterkey</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nf>**MASTERKEY**</span>
</span></span><span class=line><span class=cl>    <span class=nf>dwVersion</span>        <span class=nf>:</span> <span class=mf>00000002</span> <span class=nf>-</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl>    <span class=nf>salt</span>             <span class=nf>:</span> <span class=nf>46bc22dbffb7cfe4cfc5895acf364a94</span>
</span></span><span class=line><span class=cl>    <span class=nf>rounds</span>           <span class=nf>:</span> <span class=nf>00001f40</span> <span class=nf>-</span> <span class=mf>8000</span>
</span></span><span class=line><span class=cl>    <span class=nf>algHash</span>          <span class=nf>:</span> <span class=nf>0000800e</span> <span class=nf>-</span> <span class=mf>32782</span> <span class=s>(CALG_SHA_512)</span>
</span></span><span class=line><span class=cl>    <span class=nf>algCrypt</span>         <span class=nf>:</span> <span class=mf>00006610</span> <span class=nf>-</span> <span class=mf>26128</span> <span class=s>(CALG_AES_256)</span>
</span></span><span class=line><span class=cl>    <span class=nf>pbKey</span>            <span class=nf>:</span> <span class=nf>a332e98ce791b7416157137e7193596d4594dc599acc321f6ed9e94a818879461639b958099ab61361c7fd4d6668ca2d8995488ffba78758b945dcbfc60498c84b14c8021fbee8d90cf4165637222c8a6cd1eb3c5a85acf85177b1ec86240c7e077eb5e427e27832f3481664baf54c06cb3bb47bcfc253620958f02f69bc98ece8e51b6ef3c498047efb4a2b57bf804b</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nf>backupkey</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nf>**MASTERKEY**</span>
</span></span><span class=line><span class=cl>    <span class=nf>dwVersion</span>        <span class=nf>:</span> <span class=mf>00000002</span> <span class=nf>-</span> <span class=mf>2</span>
</span></span><span class=line><span class=cl>    <span class=nf>salt</span>             <span class=nf>:</span> <span class=nf>16b1972d3eb971ab727d3ad4e392c1ca</span>
</span></span><span class=line><span class=cl>    <span class=nf>rounds</span>           <span class=nf>:</span> <span class=nf>00001f40</span> <span class=nf>-</span> <span class=mf>8000</span>
</span></span><span class=line><span class=cl>    <span class=nf>algHash</span>          <span class=nf>:</span> <span class=nf>0000800e</span> <span class=nf>-</span> <span class=mf>32782</span> <span class=s>(CALG_SHA_512)</span>
</span></span><span class=line><span class=cl>    <span class=nf>algCrypt</span>         <span class=nf>:</span> <span class=mf>00006610</span> <span class=nf>-</span> <span class=mf>26128</span> <span class=s>(CALG_AES_256)</span>
</span></span><span class=line><span class=cl>    <span class=nf>pbKey</span>            <span class=nf>:</span> <span class=nf>bc71f554919b4d147bf51f53950fa13278979eef7398d84ecf500988864dc52eecbe9a0201a74dbb62f38e3b7957e5aa67297c29292cba05a46007bc04f1237304ee4b064442356be165ea54e0ed2664adeb1abbeb98bfe0f5b714f00d50da8d0e9271908b036dcb2aff44f2724f41bd</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nf>credhist</span><span class=p>]</span>
</span></span><span class=line><span class=cl>  <span class=nf>**CREDHIST</span> <span class=nf>INFO**</span>
</span></span><span class=line><span class=cl>    <span class=nf>dwVersion</span>        <span class=nf>:</span> <span class=mf>00000003</span> <span class=nf>-</span> <span class=mf>3</span>
</span></span><span class=line><span class=cl>    <span class=nf>guid</span>             <span class=nf>:</span> <span class=p>{</span><span class=nf>ba7fc17c-8195-4272-afae-c9fc71e42540</span><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nf>masterkey</span><span class=p>]</span> <span class=nf>with</span> <span class=nf>volatile</span> <span class=nf>cache:</span> <span class=nf>SID:S-1-5-21-3854677062-280096443-3674533662-1001;GUID:</span><span class=p>{</span><span class=nf>ba7fc17c-8195-4272-afae-c9fc71e42540</span><span class=p>}</span><span class=nf>;MD4:753621b31cbdb532e69fcb2e64924cfe;SHA1:f6f173c285829fccc958584ac81ae15a572fd69c;</span>
</span></span><span class=line><span class=cl>  <span class=nf>key</span> <span class=nf>:</span> <span class=nf>ca4387eb0a71fc0eea23e27f54b9ae240379c9e82a05d6fca73ecee13ca2e0e4d98390844697d8ed10715415c56152653edf460a47b70ddb868a03ee6a3f9840</span>
</span></span><span class=line><span class=cl>  <span class=nf>sha1:</span> <span class=nf>217522c457cfe8a95da45da81d6b898080e2067d</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>[</span><span class=nf>masterkey</span><span class=p>]</span> <span class=nf>with</span> <span class=nf>password:</span> <span class=p>[</span><span class=nf>password</span> <span class=nf>redacted</span><span class=p>]</span> <span class=s>(protected user)</span>
</span></span><span class=line><span class=cl>  <span class=nf>key</span> <span class=nf>:</span> <span class=nf>ca4387eb0a71fc0eea23e27f54b9ae240379c9e82a05d6fca73ecee13ca2e0e4d98390844697d8ed10715415c56152653edf460a47b70ddb868a03ee6a3f9840</span>
</span></span><span class=line><span class=cl>  <span class=nf>sha1:</span> <span class=nf>217522c457cfe8a95da45da81d6b898080e2067d</span>
</span></span></code></pre></div><p>Here we got the <code>Master Key</code>. We need encrypted key to proceed further, which we found in <code>AppData/Local/Google/Chrome/User Data/Local State</code>.</p><h4 id=encrypted-key>Encrypted Key</h4><p><figure><img src=/posts/chrome/15.png title="Cyberchef: encrypted_key" style="display:block;margin:0 auto"><figcaption class="text-sm text-center text-slate-500 dark:text-slate-300"><strong>Cyberchef: encrypted_key</strong></figcaption></figure>Here we got the encrypted key, we can use it.</p><div class=highlight><pre tabindex=0 class=chroma><code class=language-ps data-lang=ps><span class=line><span class=cl><span class=nf>mimikatz</span> <span class=nf>#</span> <span class=nf>dpapi::chrome</span> <span class=nv>/in:&#34;Z:\AppData\Local\Google\Chrome\User</span> <span class=nf>Data\Default\Login</span> <span class=nf>Data&#34;</span> <span class=nv>/masterkey:&#34;ca4387eb0a71fc0eea23e27f54b9ae240379c9e82a05d6fca73ecee13ca2e0e4d98390844697d8ed10715415c56152653edf460a47b70ddb868a03ee6a3f9840&#34;</span> <span class=nv>/encryptedKey:RFBBUEkBAAAA0Iyd3wEV0RGMegDAT8KX6wEAAACHYWuMqo69SL4WmCEqRBWAAAAAAAIAAAAAABBmAAAAAQAAIAAAAHPuV6P/8jN+rng8E61Z0xxi2hUf4Q4oxa5gFqSnctqdAAAAAA6AAAAAAgAAIAAAAAEF9lst8zMKmCFJ3WmD46TZY/xJF+s5Xf9mTQ2wa16ZMAAAABFU2C2V+l6K3y7ROKkA0cIaWyuXB9i7zUwBBu6mt7vM2QGZtqmjhcX6ZSWrX8JUwkAAAADgBkMLAP19Rtax5T8aKAESgwV+ABz65DOgEGwwSkkQMbWrwz7p42SzpfJUj7jcyUSTOblLRNtB8YTwhm3wCQSi</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span> <span class=nf>Encrypted</span> <span class=nf>Key</span> <span class=nf>seems</span> <span class=nf>to</span> <span class=nf>be</span> <span class=nf>protected</span> <span class=nf>by</span> <span class=nf>DPAPI</span>
</span></span><span class=line><span class=cl> <span class=nf>*</span> <span class=nf>volatile</span> <span class=nf>cache:</span> <span class=nf>GUID:</span><span class=p>{</span><span class=nf>8c6b6187-8eaa-48bd-be16-98212a441580</span><span class=p>}</span><span class=nf>;KeyHash:217522c457cfe8a95da45da81d6b898080e2067d;Key:available</span>
</span></span><span class=line><span class=cl> <span class=nf>*</span> <span class=nf>masterkey</span>     <span class=nf>:</span> <span class=nf>ca4387eb0a71fc0eea23e27f54b9ae240379c9e82a05d6fca73ecee13ca2e0e4d98390844697d8ed10715415c56152653edf460a47b70ddb868a03ee6a3f9840</span>
</span></span><span class=line><span class=cl><span class=p>&gt;</span> <span class=nf>AES</span> <span class=nf>Key</span> <span class=nf>is:</span> <span class=nf>9a3094f1bfe3e19d5d039fb569d35d49ad083ac34dbcd5d9e42a506b8d4a192c</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>URL</span>     <span class=nf>:</span> <span class=nf>https:</span><span class=err>//</span><span class=p>[</span><span class=nf>url</span> <span class=nf>redacted</span><span class=p>]</span><span class=err>/</span> <span class=s>( https://[url redacted]/ )</span>
</span></span><span class=line><span class=cl><span class=nf>Username:</span> <span class=nf>Administrator</span>
</span></span><span class=line><span class=cl> <span class=nf>*</span> <span class=nf>using</span> <span class=nf>BCrypt</span> <span class=nf>with</span> <span class=nf>AES-256-GCM</span>
</span></span><span class=line><span class=cl><span class=nf>Password:</span> <span class=p>[</span><span class=nf>password</span> <span class=nf>redacted</span><span class=p>]</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=nf>URL</span>     <span class=nf>:</span> <span class=nf>https:</span><span class=err>//</span><span class=p>[</span><span class=nf>url</span> <span class=nf>redacted</span><span class=p>]</span><span class=err>/</span> <span class=s>( https://[url redacted]/ )</span>
</span></span><span class=line><span class=cl><span class=nf>Username:</span> <span class=nf>chrome</span>
</span></span><span class=line><span class=cl> <span class=nf>*</span> <span class=nf>using</span> <span class=nf>BCrypt</span> <span class=nf>with</span> <span class=nf>AES-256-GCM</span>
</span></span><span class=line><span class=cl><span class=nf>Password:</span> <span class=p>[</span><span class=nf>password</span> <span class=nf>redacted</span><span class=p>]</span>
</span></span></code></pre></div><p>We solved the lab.<br>Happy Hacking !!! &#x1f60e;</p></article><script type=text/javascript>(function(){const i=document.querySelector(".darkmode-toggle input"),s="light",n="dark";let a=localStorage.theme===n||!("theme"in localStorage)&&window.matchMedia("(prefers-color-scheme: dark)").matches,t=a?n:s;const e=document.createElement("script");e.type="text/javascript";const r={repo:"cyberjagadeesh/cyberjagadeesh.github.io",repoId:"R_kgDOMfA4MA",category:"General",categoryId:"DIC_kwDOMfA4MM4ChYzn",mapping:"url",reactionsEnabled:"1",emitMetadata:"0",theme:t,lang:"en"};e.src="https://giscus.app/client.js",e.crossorigin="anonymous",e.async=!0,Object.entries(r).forEach(function(t){return e.dataset[t[0]]=t[1]});const o=document.currentScript;o.parentNode.insertBefore(e,o);function c(e){const t=document.querySelector("iframe.giscus-frame");if(!t)return;t.contentWindow.postMessage({giscus:e},"https://giscus.app")}i.addEventListener("change",function(){this.checked?t=n:t=s,c({setConfig:{theme:t}})})})()</script></div></div></div></main><footer class="flex flex-none justify-center"><section class="flex flex-col md:flex-row mx-2 md:mx-0 gap-2 md:gap-0 justify-between w-full max-w-4xl lg:max-w-5xl py-6 text-slate-500 dark:text-slate-300"><div class="flex flex-row"><a href=https://www.linkedin.com/in/jagadeeshwaran-m-562a011b3 target=_blank title=LinkedIn class="flex flex-row mr-2"><span class=hidden>LinkedIn</span>
<i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-brand-linkedin" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 2a2 2 0 012-2h12a2 2 0 012 2v12a2 2 0 01-2 2H6a2 2 0 01-2-2z"/><path d="M8 11v5"/><path d="M8 8v.01"/><path d="M12 16v-5"/><path d="M16 16v-3a2 2 0 00-4 0"/></svg></i></a></div><div class=grow></div><div class="flex flex-row"><i class="h-6 w-6 flex-none"><svg class="icon icon-tabler icon-tabler-copyright" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 12m-9 0a9 9 0 1018 0A9 9 0 103 12"/><path d="M14 9.75a3.016 3.016.0 00-4.163.173 2.993 2.993.0 000 4.154A3.016 3.016.0 0014 14.25"/></svg>
</i>2024 CyberJagadeesh</div></section></footer><script src=/main.min.c6372b6836971865bd94bfde974748aca8415824a2facab6ccd66a87384bfacb.js></script><div class="hidden top-1 right-1" id=code-copy><i class="h-6 w-6 block"><svg class="icon icon-tabler icon-tabler-copy" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 7m0 2.667A2.667 2.667.0 019.667 7h8.666A2.667 2.667.0 0121 9.667v8.666A2.667 2.667.0 0118.333 21H9.667A2.667 2.667.0 017 18.333z"/><path d="M4.012 16.737A2.005 2.005.0 013 15V5c0-1.1.9-2 2-2h10c.75.0 1.158.385 1.5 1"/></svg></i></div><div class="hidden top-1 right-1" id=code-copy-done><i class="h-6 w-6 block"><svg class="icon icon-tabler icon-tabler-check" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 12l5 5L20 7"/></svg></i></div><script src=/code-copy.min.e7b2a74adef1ed474c335c8bd5e7832b2316b8842b0f9184d65286c5bd64f51a.js></script></body></html>